# Webpack 构建流程

1. **初始化参数**：从配置文件和 shell 语句中读取与合并参数，得出最终的参数。
2. 利用得到的参数**初始化 compiler 对象**
3. **加载所有配置的插件**：依次调用插件的 apply 方法，让插件可以监听 webpack 的生命周期，并且绑定相应的钩子函数。
4. **执行对象的 run 方法开始执行编译**：确定入口，调用所有配置的插件的 apply 方法开始执行编译。
5. **确定入口**：根据配置中的 entry 找出所有的入口文件。
6. **编译模块**：从入口文件出发，调用所有配置的 loader 对模块进行编译，再找出该模块依赖的模块，递归进行编译，直到所有入口依赖的文件都经过了本步骤的处理。
7. **完成模块编译**：根据入口和模块之间的依赖关系，组装成一个个包含多个模块的 Chunk，再把每个 Chunk 转换成一个单独的文件加入到输出列表。
8. **输出资源**：根据配置确定输出的路径和文件名，把文件内容写入到文件系统。

## Vite 的构建流程

1. **依赖与预构建** Vite 启东时会对 node_modules 中的依赖进行预构建，将 commonJS 模块转换成 es 模块，这样浏览器可以直接通过 import 引入，而不需要再通过打包器进行打包，从而提升开发体验。
2. **开发启动服务器模式**，Vite 通过劫持浏览器的请求，将浏览器请求的文件路径映射到文件系统中的实际路径，然后读取文件内容，并返回给浏览器。基于原生 ESMoudle，Vite 不需要像 Webpack 那样打包，而是直接将源码返回给浏览器，从而实现快速的开发体验。
3. **‌ 按需编译与热更新**‌。

- ‌ 按需编译 ‌：浏览器请求文件时，Vite 通过插件（如@vitejs/plugin-vue）即时编译单文件组件（SFC）或 TypeScript 文件。‌‌

- ‌HMR 热更新 ‌：修改文件后，仅重新编译变更部分，通过 WebSocket 推送更新到浏览器，保持应用状态。‌‌

‌‌

**‌ 生产环境构建 ‌**

生产模式下，Vite 使用 `Rollup` 进行全量打包，生成优化的静态资源（代码分割、Tree-shaking 等），配置文件为 vite.config.js。‌‌

‌‌
