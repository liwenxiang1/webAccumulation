"use strict";(self.webpackChunkliwx_docs=self.webpackChunkliwx_docs||[]).push([[5181],{3955:(e,i,n)=>{n.r(i),n.d(i,{comp:()=>l,data:()=>r});var s=n(641);const a=[(0,s.Fv)('<h2 id="nginx-常见配置" tabindex="-1"><a class="header-anchor" href="#nginx-常见配置"><span>Nginx 常见配置</span></a></h2><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>    server {\n        listen       9000;\n        server_name  192.168.4.32;   #监听地址\n\n        location  ~ /example1/ {\n           proxy_pass http://127.0.0.1:5000;\n        }\n\n        location  ~ /example2/ {\n           proxy_pass http://127.0.0.1:8080;\n        }\n    }\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>location 指令用于匹配 URL，proxy_pass 指令用于反向代理，将请求转发到指定的地址。</p><p><em>location 指令说明：</em></p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>~ : 表示 uri 包含正则表达式，且区分大小写。\n~* : 表示 uri 包含正则表达式，且不区分大小写。\n= : 表示 uri 不含正则表达式，要求严格匹配。\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="nginx-配置-gzip-压缩" tabindex="-1"><a class="header-anchor" href="#nginx-配置-gzip-压缩"><span>Nginx 配置 gzip 压缩</span></a></h2><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>    server {\n        listen       9000;\n        server_name  192.168.4.32;   #监听地址\n\n        gzip on; //启用gzip压缩。\n        gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript; //指定哪些MIME类型的响应内容需要压缩。\n        gzip_min_length 1024; //设置启用压缩的最小响应内容长度。\n        gzip_comp_level 6; //设置压缩级别，级别越高，压缩率越高，但CPU消耗也越高。\n        gzip_proxied any; //设置代理服务器是否启用压缩。\n        gzip_vary on; //设置是否在响应头中添加 Vary: Accept-Encoding 字段，以告知客户端是否启用压缩。\n        gzip_disable &quot;MSIE [1-6]\\.&quot;; //设置哪些客户端禁用压缩。\n\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="nginx-配置负载均衡" tabindex="-1"><a class="header-anchor" href="#nginx-配置负载均衡"><span>Nginx 配置负载均衡</span></a></h2><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>    upstream backend {\n        server 127.0.0.1:5000;\n        server 127.0.0.1:8080;\n    }\n\n    server {\n        listen       9000;\n        server_name  192.168.4.32;   #监听地址\n\n        location  ~ /example1/ {\n           proxy_pass http://backend;\n        }\n    }\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>upstream 指令用于定义一组后端服务器，proxy_pass 指令用于将请求转发到后端服务器。</p><h2 id="nginx-配置缓存" tabindex="-1"><a class="header-anchor" href="#nginx-配置缓存"><span>Nginx 配置缓存</span></a></h2><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>    server {\n        listen       9000;\n        server_name  192.168.4.32;   #监听地址\n\n        location  ~ /example1/ {\n            proxy_pass http://192.168.4.32:5000；#如果没有缓存则转向请求\n            proxy_redirect off;\n            proxy_cache cache_one;\n            proxy_cache_valid 200 1h;            #对不同的 HTTP 状态码设置不同的缓存时间\n            proxy_cache_valid 500 1d;\n            proxy_cache_valid any 1m;\n            expires 1d;  #设置缓存时间为1天\n        }\n    }\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>expires</code> 指令用于设置缓存时间。通过 expires 参数设置，可以使浏览器缓存过期时间之前的内容，减少与服务器之间的请求和流量。也就是说无需去服务端验证，直接通过浏览器自身确认是否过期即可，所以不会产生额外的流量。此种方法非常适合不经常变动的资源。</p><p><strong>nginx 分配服务器策略:</strong></p><p><strong>- 轮询(默认)</strong></p><p>按请求的时间顺序依次逐一分配，如果服务器 down 掉，能自动剔除。</p><p><strong>- 权重</strong></p><p><code>weight</code> 越高被分配的客户端越多，默认为 1</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>upstream backend {\n    server 127.0.0.1:5000 weight=1;\n    server 127.0.0.1:8080 weight=2;\n}\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>- ip_hash</strong></p><p>每个请求按访问 <code>ip</code> 的<code> hash</code> 结果分配，这样每个访客固定访问一个后端服务器</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>upstream backend {\n    ip_hash;\n    server 127.0.0.1:5000;\n    server 127.0.0.1:8080;\n}\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>- fair</strong></p><p>按后端服务器的响应时间来分配请求，响应时间短的优先分配。</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>upstream backend {\n    fair;\n    server 127.0.0.1:5000;\n    server 127.0.0.1:8080;\n}\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>- url_hash</strong></p><p>按访问 url 的 hash 结果来分配请求，使每个 url 定向到同一个后端服务器，后端服务器为缓存时比较有效。</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>upstream backend {\n    hash $request_uri;\n    server 127.0.0.1:5000;\n    server 127.0.0.1:8080;\n}\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="nginx-动静分离" tabindex="-1"><a class="header-anchor" href="#nginx-动静分离"><span>Nginx 动静分离</span></a></h2><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>upstream static {\n    server 192.167.4.31:80;\n}\n\nupstream dynamic {\n    server 192.167.4.32:8080;\n}\n\nserver {\n    listen       80;   #监听端口\n    server_name  www.abc.com; 监听地址\n\n    # 拦截动态资源\n    location ~ .*\\.(php|jsp)$ {\n       proxy_pass http://dynamic;\n    }\n\n    # 拦截静态资源\n    location ~ .*\\.(jpg|png|htm|html|css|js)$ {\n       root /data/;  #html目录\n       proxy_pass http://static;\n       autoindex on;;  #自动打开文件列表\n    }\n}\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',30)],d={},l=(0,n(6262).A)(d,[["render",function(e,i){return(0,s.uX)(),(0,s.CE)("div",null,a)}]]),r=JSON.parse('{"path":"/mianshi/Nginx%E9%85%8D%E7%BD%AE.html","title":"","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"Nginx 常见配置","slug":"nginx-常见配置","link":"#nginx-常见配置","children":[]},{"level":2,"title":"Nginx 配置 gzip 压缩","slug":"nginx-配置-gzip-压缩","link":"#nginx-配置-gzip-压缩","children":[]},{"level":2,"title":"Nginx 配置负载均衡","slug":"nginx-配置负载均衡","link":"#nginx-配置负载均衡","children":[]},{"level":2,"title":"Nginx 配置缓存","slug":"nginx-配置缓存","link":"#nginx-配置缓存","children":[]},{"level":2,"title":"Nginx 动静分离","slug":"nginx-动静分离","link":"#nginx-动静分离","children":[]}],"git":{},"filePathRelative":"mianshi/Nginx配置.md"}')}}]);