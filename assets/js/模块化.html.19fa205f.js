"use strict";(self.webpackChunkliwx_docs=self.webpackChunkliwx_docs||[]).push([[3468],{3020:(n,s,a)=>{a.r(s),a.d(s,{comp:()=>k,data:()=>v});var t=a(641);const p=a.p+"assets/img/什么是模块化.d7243ad3.jpg",e=a.p+"assets/img/node的commonJS.e253dac7.jpg",o=a.p+"assets/img/node中commonJS的原理.e07eb29a.png",c=a.p+"assets/img/node中requires的源码.ebc9d2cf.jpg",i=a.p+"assets/img/require查找.ba313e69.jpg",l=a.p+"assets/img/模块的加载过程--深度优先搜索.c7ff87c9.jpg",u=a.p+"assets/img/do-main.2215cfd0.jpg",r=[(0,t.Fv)('<h1 id="模块化" tabindex="-1"><a class="header-anchor" href="#模块化"><span>模块化</span></a></h1><p><img src="'+p+'" alt=""></p><h2 id="commonjs" tabindex="-1"><a class="header-anchor" href="#commonjs"><span>commonJS</span></a></h2><p>它是一种规范，node 是其中的一种实现，为了在浏览器以外来使用的，所以会有一些限制，比如同步加载，因为浏览器不支持同步加载，所以需要一些工具来支持，比如 webpack，browserify</p><p><img src="'+e+'" alt=""></p><p><strong>导出方法</strong></p><p>1、module.exports = {} 导出对象.module 是当前模块的对象，它里面有个 exports 属性，用来导出模块</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>\nmodule<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>\n  a<span class="token punctuation">,</span>\n  b<span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 导入使用</span>\n<span class="token keyword">const</span> <span class="token punctuation">{</span> a<span class="token punctuation">,</span> b <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./a.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>内部原理</strong> 将返回的 info 对象，赋值给 module.exports。require 是一个函数，主要的作用是根据输入的文件，拿到 module.exports 的值，返回给调用者</p><p><img src="'+o+'" alt=""></p><p>2.exports 导出对象，exports 是 module.exports 的引用</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>\nexports <span class="token operator">=</span> <span class="token punctuation">{</span>\n  a<span class="token punctuation">,</span>\n  b<span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 导入使用</span>\n<span class="token keyword">const</span> <span class="token punctuation">{</span> a<span class="token punctuation">,</span> b <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./a.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>源码；</strong></p><p><img src="'+c+'" alt=""></p><p><strong>require 的查找规则</strong></p><p>导入格式：require(X)</p><ol><li>如果 X 是核心模块（http、fs(fileSystem)、path 等），则返回核心模块，并且停止查找</li><li>如果 X 是以 ./ 或 ../ 或 /（根目录）开头的，根据 X 的路径去文件系统中定位文件.如果没有后缀名，会按照如下顺序：</li></ol><ul><li>直接查找文件 X</li><li>查找 X.js</li><li>查找 X.json</li><li>查找 X.node 如果没找到文件，再按照文件夹查找，默认查找 X/index 文件</li></ul><ol start="3"><li>如果 X 不是路径也不是核心模块，则 node 会从当前模块的父目录开始，尝试从它的 /node_modules 目录里加载模块。如果没有找到，则移动到再上一级父目录，直到文件系统的根目录</li></ol><p><img src="'+i+'" alt=""></p><ol start="4"><li>如果在以上过程中都未找到，则会抛出异常</li></ol><p><strong>commonJS 的加载过程</strong></p><p>1、模块第一次被引用时，模块中的 js 代码都会被运行一次，然后缓存</p><p>2、被多次引用，有缓存</p><blockquote><p>每个模块对应自己的 module 实例，里面有个 loaded 属性，false 为从未加载过，true 表示已经加载。用来标识模块是否被加载过，加载过则直接返回，没有则加载</p></blockquote><p>3、如果有循环引用，则按照顺序执行，执行完再返回</p><p><img src="'+l+'" alt=""></p><p><strong>commonJS 的缺点</strong></p><p>1、同步加载，浏览器不支持同步加载，所以需要一些工具来支持，比如 webpack，browserify</p><p>2、没有私有变量，所有变量都是共享的，污染全局作用域</p><p>3、循环引用，会导致死循环</p><h2 id="amd" tabindex="-1"><a class="header-anchor" href="#amd"><span>AMD</span></a></h2><p>AMD 是异步加载模块，requireJS 是 AMD 的实现，AMD 是 requireJS 在浏览器端的实现，requireJS 是一个第三方库，用来解决浏览器端模块化的问题</p><p><img src="'+u+'" alt=""></p><p>data-main 是一个属性，用来指定加载的 js 文件，src 加载完成后，立即加载 index.js</p><p>AMD 的使用</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token comment">// 方式1</span>\n<span class="token comment">// 定义模块</span>\n<span class="token function">define</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token punctuation">{</span>\n    <span class="token function-variable function">start</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      module2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;module1 start&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token comment">// 引用模块</span>\nrequire<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">{</span>\n    <span class="token literal-property property">baseUrl</span><span class="token operator">:</span> <span class="token string">&#39;./src&#39;</span><span class="token punctuation">,</span>\n  <span class="token literal-property property">paths</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token literal-property property">module1</span><span class="token operator">:</span> <span class="token string">&#39;./module1&#39;</span><span class="token punctuation">,</span>\n    <span class="token literal-property property">module2</span><span class="token operator">:</span> <span class="token string">&#39;./module2&#39;</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;module1&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;module2&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module1<span class="token punctuation">,</span> module2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  module1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  module2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span>\n<span class="token comment">// 方式二</span>\n<span class="token comment">// 定义模块 依赖module2模块</span>\n<span class="token function">define</span><span class="token punctuation">(</span><span class="token string">&#39;module1&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&#39;module2&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token punctuation">{</span>\n    <span class="token function-variable function">start</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      module2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;module1 start&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// 引入模块</span>\n<span class="token function">require</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&#39;module1&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  module1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="es-module" tabindex="-1"><a class="header-anchor" href="#es-module"><span>ES Module</span></a></h1><p>ES Module 使用的是 import 和 export</p><p>export 导出模块，import 引入模块</p><p>采用 ES Module 代码自动开启严格模式</p><p>必须加 type=module,否则不是一个模块</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">&quot;module&quot;</span> src<span class="token operator">=</span><span class="token string">&#39;&#39;</span><span class="token operator">&gt;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>导出方式 1</strong></p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n<span class="token keyword">export</span> <span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>\n<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;start&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>导出方式 2</strong> export 是一个语法，不是一个对象</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>\n<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>\n<span class="token keyword">function</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;start&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n<span class="token keyword">export</span> <span class="token punctuation">{</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> start <span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>导出方式 3</strong>,方式二取别名</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token punctuation">{</span> a <span class="token keyword">as</span> a1<span class="token punctuation">,</span> b <span class="token keyword">as</span> b1<span class="token punctuation">,</span> start <span class="token keyword">as</span> start1 <span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>导出方式 4</strong>,导出默认，一个模块只能有一个默认导出</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>\n  a<span class="token punctuation">,</span>\n  b<span class="token punctuation">,</span>\n  start<span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>导出方式 5</strong></p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;start&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>导出方式 6</strong></p><p>export default { aaa(){</p><pre><code>}\n</code></pre><p>}</p><p><strong>导入方式 1</strong></p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> start <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./a.js&#39;</span><span class="token punctuation">;</span>\nconsole<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>导入方式 2</strong>,取别名</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> module1 <span class="token keyword">from</span> <span class="token string">&#39;./a.js&#39;</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>导入方式 3</strong>，将导出的所有内容放到一个标志符中</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">import</span> foo <span class="token keyword">from</span> <span class="token string">&#39;./foo.js&#39;</span><span class="token punctuation">;</span>\nfoo<span class="token punctuation">.</span>a<span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>导入方式 4</strong>,动态导入，返回一个 promise</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#39;./foo.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">module</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  module<span class="token punctuation">.</span>a<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',65)],d={},k=(0,a(6262).A)(d,[["render",function(n,s){return(0,t.uX)(),(0,t.CE)("div",null,r)}]]),v=JSON.parse('{"path":"/accumulation/%E6%A8%A1%E5%9D%97%E5%8C%96.html","title":"模块化","lang":"zh-CN","frontmatter":{},"headers":[{"level":2,"title":"commonJS","slug":"commonjs","link":"#commonjs","children":[]},{"level":2,"title":"AMD","slug":"amd","link":"#amd","children":[]}],"git":{},"filePathRelative":"accumulation/模块化.md"}')}}]);